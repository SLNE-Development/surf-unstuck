package dev.slne.antiexploit.bukkit.listener.listeners;

import java.util.List;

import org.bukkit.Material;
import org.bukkit.block.Block;
import org.bukkit.block.data.BlockData;
import org.bukkit.block.data.Rail;
import org.bukkit.block.data.type.CoralWallFan;
import org.bukkit.event.EventHandler;
import org.bukkit.event.Listener;
import org.bukkit.event.block.BlockPistonExtendEvent;
import org.bukkit.event.block.BlockPistonRetractEvent;

public class PistonListener implements Listener {

    // Prevents rail and carpet dupes and pistons from pushing CoralWallFans

    @EventHandler
    public void onPistonExtend(BlockPistonExtendEvent event) {
        List<Block> blocks = event.getBlocks();
        if (blocks.size() <= 3) {
            return;
        }

        for (Block block : event.getBlocks()) {
            Material material = block.getType();
            BlockData blockData = block.getBlockData();

            if (material == Material.AIR || blockData instanceof CoralWallFan) {
                event.setCancelled(true);
                return;
            }

            if (blockData instanceof Rail || material.toString().contains("CARPET")) {
                block.setType(Material.AIR);
            }
        }
    }

    @EventHandler
    public void onPistonExtend(BlockPistonRetractEvent event) {
        List<Block> blocks = event.getBlocks();
        if (blocks.size() <= 3) {
            return;
        }

        for (Block block : event.getBlocks()) {
            Material material = block.getType();
            BlockData blockData = block.getBlockData();

            if (material == Material.AIR || blockData instanceof CoralWallFan) {
                event.setCancelled(true);
                return;
            }

            if (blockData instanceof Rail || material.toString().contains("CARPET")) {
                block.setType(Material.AIR);
            }
        }
    }

}
